# STM32 CMake YML Framework

[![Version](https://img.shields.io/badge/version-0.5.0-blue.svg)](https://github.com/yourname/yourrepo/releases)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

**`stm32-cmake-yml`** ‚Äî —ç—Ç–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∫–∏ CMake, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–æ—â–µ–Ω–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–¥ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã STM32. –û–Ω —è–≤–ª—è–µ—Ç—Å—è –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π "–æ–±–µ—Ä—Ç–∫–æ–π" –Ω–∞–¥ –ø–æ–ø—É–ª—è—Ä–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Å–∫—Ä–∏–ø—Ç–æ–≤(https://github.com/ObKo/stm32-cmake), –∑–∞–º–µ–Ω—è—è —Å–ª–æ–∂–Ω–æ–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ `CMakeLists.txt` –Ω–∞ –æ–¥–∏–Ω –ø—Ä–æ—Å—Ç–æ–π –∏ —á–∏—Ç–∞–µ–º—ã–π —Ñ–∞–π–ª ‚Äî `stm32_config.yml`.

## –§–∏–ª–æ—Å–æ—Ñ–∏—è –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å:** –û–ø–∏—Å—ã–≤–∞–π—Ç–µ *—á—Ç–æ* –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–±—Ä–∞—Ç—å, –∞ –Ω–µ *–∫–∞–∫*.
* **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è:** –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –æ–¥–Ω–æ–º YAML-—Ñ–∞–π–ª–µ.
* **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è:** –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä—É—Ç–∏–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ–∏—Å–∫ –¥—Ä–∞–π–≤–µ—Ä–æ–≤, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤ –∫–æ–º–ø–æ–Ω–æ–≤—â–∏–∫–∞) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
* **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ **CRC32** –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ `ELF`-—Ñ–∞–π–ª –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏.
* **–ì–∏–±–∫–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∏–∑ STM32CubeMX (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `.ioc` —Ñ–∞–π–ª–∞–º–∏), —Ç–∞–∫ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–∞—Å—Ç–æ–º–Ω—ã–µ (legacy) –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

* **CMake** >= 3.19
* **ARM GCC Toolchain** (–Ω–∞–ø—Ä–∏–º–µ—Ä, xPack GNU Arm Embedded GCC)
* **yq** (–∫–æ–Ω—Å–æ–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ YAML)
* **Python 3.x** (—Ç—Ä–µ–±—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ** –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è CRC32)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –∏ –ø—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–µ–∫—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–µ–º–µ–π—Å—Ç–≤ –º–∏–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ (F0, F1, F4, F7, H5, H7), –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
üëâ **(https://github.com/ViacheslavMezentsev/demo-stm32-cmake)**

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

–≠—Ç–æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º, –∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –≤–∞—à–∏ –ø—Ä–æ–µ–∫—Ç—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ **Git-—Å–∞–±–º–æ–¥—É–ª—è**.

### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∞—à–µ–≥–æ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:

```text
my-project/
‚îú‚îÄ‚îÄ .vscode/
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îî‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îú‚îÄ‚îÄ stm32-cmake/         # <== Git Submodule
‚îÇ   ‚îî‚îÄ‚îÄ stm32-cmake-yml/     # <== –≠–¢–û–¢ –§–†–ï–ô–ú–í–û–†–ö (Git Submodule)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ CMakeLists.txt           # <-- –ì–ª–∞–≤–Ω—ã–π CMake-—Ñ–∞–π–ª –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ stm32_config.yml         # <-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
```

### 2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø—Ä–æ–µ–∫—Ç—É

1. –í –∫–æ—Ä–Ω–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `stm32-cmake` –∫–∞–∫ —Å–∞–±–º–æ–¥—É–ª–∏:

    ```bash
    git submodule add https://github.com/ObKo/stm32-cmake.git modules/stm32-cmake
    git submodule add https://github.com/ViacheslavMezentsev/stm32-cmake-yml.git modules/stm32-cmake-yml
    ```

2. –°–æ–∑–¥–∞–π—Ç–µ –≤ –∫–æ—Ä–Ω–µ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ **`CMakeLists.txt`** —Å–æ —Å–ª–µ–¥—É—é—â–∏–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

    ```cmake
    cmake_minimum_required(VERSION 3.19)

    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è STM32: https://github.com/ObKo/stm32-cmake
    set(CMAKE_TOOLCHAIN_FILE "${CMAKE_CURRENT_SOURCE_DIR}/modules/stm32-cmake/cmake/stm32_gcc.cmake")

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ –Ω–∞—à–µ–º—É —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É.
    set(STM32_YML_FRAMEWORK_DIR "${CMAKE_CURRENT_SOURCE_DIR}/modules/stm32-cmake-yml")

    # –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫—É –≤ CMAKE_MODULE_PATH.
    list(APPEND CMAKE_MODULE_PATH "${STM32_YML_FRAMEWORK_DIR}")

    # –ü–æ–¥–∫–ª—é—á–∞–µ–º –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.
    include(stm32_yml)

    # (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–º—è –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–∞.
    # set(PROJECT_CONFIG_FILE "my_custom_config.yml" CACHE STRING "..." FORCE)

    # –í—ã–∑—ã–≤–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é.
    # –û–Ω–∞ –ø—Ä–æ—á–∏—Ç–∞–µ—Ç YAML –∏ –≤–µ—Ä–Ω–µ—Ç –Ω–∞–º –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤.
    stm32_yml_prepare_project_data(PROJECT_NAME PROJECT_LANGUAGES)

    project(${PROJECT_NAME} LANGUAGES ${PROJECT_LANGUAGES})

    # –í—ã–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
    stm32_yml_setup_project(${PROJECT_NAME})
    ```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª **`stm32_config.yml`** –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ –ø–æ–¥ –≤–∞—à –ø—Ä–æ–µ–∫—Ç. –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –æ–ø—Ü–∏–π –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤(docs/user_manual.md).

## –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE`.
